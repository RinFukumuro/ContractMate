# ContractMate6 PDFページジャンプテスト

## PDFファイルへのリンク（ページジャンプ機能テスト）

以下のリンクをクリックすると、対応するPDFファイルがVSCode内で開きます。ページ番号が指定されている場合は、そのページにジャンプします。

### 伊藤塾再現.pdf ファイルへのリンク（実際のファイル）

- [伊藤塾再現 (1ページ目)](file:///C:/Users/Orinr/Downloads/%E4%BC%8A%E8%97%A4%E5%A1%BE%E5%86%8D%E7%8F%BE.pdf) - ページ指定なし
- [伊藤塾再現 (2ページ目)](file:///C:/Users/Orinr/Documents/Gemini_pdf/平成28年2月3日パブリックコメント.pdf#page=2) - #page=N形式でページ指定
- [伊藤塾再現 (3ページ目)](file:///C:/Users/Orinr/Downloads/%E4%BC%8A%E8%97%A4%E5%A1%BE%E5%86%8D%E7%8F%BE.pdf#page=3) - #page=N形式でページ指定

**注意**: 現在のバージョンでは、`#page=N`形式のページ指定のみがサポートされています。

### テスト手順

1. このファイルをVSCodeで開きます
2. Markdownプレビューを表示します（`Ctrl+Shift+V`または`Cmd+Shift+V`）
3. 上記のリンクを順番にクリックして、各ページが正しく表示されるか確認します
4. `#page=N`形式のリンクが正しく機能するか確認してください

### 追加のテストケース

- [伊藤塾再現 (存在しないページ)](file:///C:/Users/Orinr/Downloads/%E4%BC%8A%E8%97%A4%E5%A1%BE%E5%86%8D%E7%8F%BE.pdf#page=999) - 存在しないページ番号を指定（最終ページが表示されます）
- [伊藤塾再現 (0ページ目)](file:///C:/Users/Orinr/Downloads/%E4%BC%8A%E8%97%A4%E5%A1%BE%E5%86%8D%E7%8F%BE.pdf#page=0) - 無効なページ番号を指定（最初のページが表示されます）

## Officeファイルへのリンク

以下のリンクをクリックすると、対応するOfficeアプリケーションでファイルが開きます。

### Word文書

- [サンプルWord文書](sample.docx) - Word文書へのリンク
- [実際のWord文書](C:/Users/Orinr/Documents/sample_contract.docx) - 実際のWord文書へのリンク（パスを変更してください）
- [Word文書 (3ページ目)](C:/Users/Orinr/Documents/sample_contract.docx) - Word文書へのリンク（ページ指定は現在サポートされていません）

## WordNavigator機能テスト

### 概要
WordNavigatorは、弁護士業務支援用のWord文書ナビゲーションツールです。このツールを使用すると、Word文書を開き、文書内の段落構造を解析し、特定の段落に即座に移動することができます。

### 主な機能
- ✅ Word文書を即座に開く
- ✅ 文書の全段落構造を取得（条項や見出しも判別可能）
- ✅ 特定の条項や段落番号を指定し、即座にその場所にジャンプ

### テスト用サンプル文書
以下のサンプル契約書を使用してWordNavigatorの機能をテストできます：

- [サンプル契約書](サンプル契約書.docx) - テスト用のサンプル契約書

### テスト手順

1. コマンドプロンプトまたはPowerShellを開きます
2. 以下のコマンドを実行して、サンプル契約書を開き、段落構造を表示します：

```
cscript wordNavigator.js "サンプル契約書.docx" 1
```

3. 特定の段落に移動するには、段落番号を変更します：

```
# 第1条（目的）に移動
cscript wordNavigator.js "サンプル契約書.docx" 5

# 第3条（契約期間）に移動
cscript wordNavigator.js "サンプル契約書.docx" 13

# 第5条（機密保持）に移動
cscript wordNavigator.js "サンプル契約書.docx" 19
```

### サンプル契約書の自動生成

サンプル契約書がない場合は、以下のスクリプトを実行して自動生成できます：

```
cscript createSampleDoc.js
```

このスクリプトは、テスト用のサンプル契約書（サンプル契約書.docx）を現在のディレクトリに作成します。

### Excelファイル

- [サンプル表計算](sample.xlsx) - Excelファイルへのリンク
- [実際の表計算](C:/path/to/your/spreadsheet.xlsx) - 実際のExcelファイルへのリンク（パスを変更してください）

### PowerPointファイル

- [サンプルプレゼン](sample.pptx) - PowerPointファイルへのリンク
- [実際のプレゼン](C:/path/to/your/presentation.pptx) - 実際のPowerPointファイルへのリンク（パスを変更してください）
- [プレゼン](C:/Users/Orinr/Documents/presentation.pptx) - PowerPointファイルへのリンク（ページ指定は現在サポートされていません）

## 画像ファイル

- [サンプル画像](sample.png) - 画像ファイルへのリンク
- [実際の画像](C:/path/to/your/image.jpg) - 実際の画像ファイルへのリンク（パスを変更してください）

## テキストファイル

- [サンプルテキスト](sample.txt) - テキストファイルへのリンク
- [実際のテキスト](C:/path/to/your/text.txt) - 実際のテキストファイルへのリンク（パスを変更してください）

## 技術的な説明

### PDFビューアのページジャンプ機能

ContractMate6のPDFビューアは、PDFファイルを開く際に特定のページに直接ジャンプする機能を提供します。この機能は、以下の形式でページ番号を指定することでご利用いただけます：

- **#page=N形式**: `file:///path/to/document.pdf#page=2`

### 問題の背景

VSCodeのURIオブジェクトには、ハッシュフラグメント（`#page=2`など）を正しく保持できないという制限があります。そのため、PDFファイルへのリンクにハッシュフラグメントでページ番号を指定しても、そのページ番号が正しく処理されませんでした。

### 解決策

この問題を解決するために、以下の修正を行いました：

1. **URIからのページ番号抽出を強化**:
   - `#page=N`形式のページ指定からページ番号を正確に抽出
   - URLエンコードされたハッシュフラグメント（`#page%3D2`形式）にも対応

2. **ページジャンプ処理の効率化**:
   - ページジャンプが確実に実行されるように処理を最適化
   - WebView側でのページジャンプ処理を改善

3. **ログ出力の最適化**:
   - 重要なログのみを出力するように変更
   - デバッグ情報の表示を整理

これらの修正により、`#page=N`形式のページ指定を含むPDFリンクが正しく機能するようになりました。